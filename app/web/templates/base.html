<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 72 72'><text y='50%' x='50%' dominant-baseline='middle' text-anchor='middle' font-size='52'>üìä</text></svg>">
  <title>{% block title %}Uptime{% endblock %}</title>
  <!-- Preconnect and load font CSS early to improve LCP (prevents @import render delay) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" onload="this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>

  <!-- Prefer self-hosted WOFF2 (faster, reliable). If you place WOFF2 files under
       /app/web/static/fonts as SpaceGrotesk-400/500/600/700.woff2 they'll be used.
       Keep the Google Fonts preload above as a fallback while files are downloaded. -->
  <link rel="preload" href="/static/fonts/SpaceGrotesk-700.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/static/fonts/SpaceGrotesk-400.woff2" as="font" type="font/woff2" crossorigin>

  <style>
    /* Self-hosted font-face declarations (weights used by the UI). */
    @font-face {
      font-family: 'Space Grotesk';
      font-style: normal;
      font-weight: 400;
      src: url('/static/fonts/SpaceGrotesk-400.woff2') format('woff2');
      font-display: swap;
    }
    @font-face {
      font-family: 'Space Grotesk';
      font-style: normal;
      font-weight: 500;
      src: url('/static/fonts/SpaceGrotesk-500.woff2') format('woff2');
      font-display: swap;
    }
    @font-face {
      font-family: 'Space Grotesk';
      font-style: normal;
      font-weight: 600;
      src: url('/static/fonts/SpaceGrotesk-600.woff2') format('woff2');
      font-display: swap;
    }
    @font-face {
      font-family: 'Space Grotesk';
      font-style: normal;
      font-weight: 700;
      src: url('/static/fonts/SpaceGrotesk-700.woff2') format('woff2');
      font-display: swap;
    }

  <style>
    /* Shared UI tokens and layout used across pages */
    :root{
      --bg: #0f172a;
      --panel: #111827;
      --surface: rgba(255,255,255,0.02);
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --accent-strong: #0ea5e9;
      --up: #34d399;
      --down: #f87171;
      --border: #0b1220;
      --card-border: #0a0f1a;
      --glow: 0 10px 40px rgba(56,189,248,0.18);
      --radius: 14px;
      --sidebar-w: 260px;
      --sidebar-bg: #0b1220;
      --sidebar-border: #0a0f1a;
    }
    body{margin:0; padding:28px; padding-left:32px; background: radial-gradient(circle at 20% 20%, rgba(56,189,248,0.08), transparent 30%), radial-gradient(circle at 80% 0%, rgba(14,165,233,0.08), transparent 26%), var(--bg); color: var(--text); font-family: 'Space Grotesk','Inter',system-ui,-apple-system,sans-serif; transition: padding-left .2s ease;}
    body.sidebar-open { padding-left: calc(var(--sidebar-w) + 32px); }
    .page{max-width:1200px;margin:0 auto;}
    .sidebar { position: fixed; inset:0 auto 0 0; width: var(--sidebar-w); background: linear-gradient(180deg, rgba(15,23,42,0.96), rgba(11,18,32,0.98)); border-right:1px solid var(--sidebar-border); padding:24px 18px; box-shadow: 6px 0 30px rgba(0,0,0,0.28); display:flex; flex-direction:column; gap:16px; z-index:50; transform: translateX(-100%); transition: transform .25s ease; }
    .sidebar .logo { font-weight:700; letter-spacing:-0.01em; display:flex; align-items:center; gap:10px; font-size:16px; }
    .sidebar nav { display:flex; flex-direction:column; gap:6px; }
    .sidebar nav a { display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; color: var(--text); text-decoration:none; border:1px solid transparent; transition: background .12s ease, border-color .12s ease; }
    .sidebar nav a span { font-weight:600; font-size:14px; }
    .sidebar nav a.active { background: rgba(56,189,248,0.12); border-color: rgba(56,189,248,0.35); color: var(--accent); }
    .sidebar nav a:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
    .nav-toggle { position: fixed; top:18px; left:18px; width:42px; height:42px; border-radius:12px; border:1px solid var(--card-border); background: rgba(255,255,255,0.04); color: var(--text); display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:60; box-shadow:0 10px 28px rgba(0,0,0,0.25); transition: left .25s ease; }
    .sidebar-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.45); opacity:0; pointer-events:none; transition: opacity .2s ease; z-index:40; }
    body.sidebar-open .sidebar-overlay { opacity:1; pointer-events:auto; }
    body.sidebar-open .sidebar { transform: translateX(0); }
    body.sidebar-open .nav-toggle { left: calc(var(--sidebar-w) + 18px); }
    a { color: var(--accent); text-decoration:none; }
    a:hover { text-decoration: underline; }
    @media(min-width:1025px){ body.sidebar-open { padding-left: calc(var(--sidebar-w) + 28px); } }
    @media(max-width:1024px){ body { padding-left:28px; } .sidebar { transform: translateX(-100%); } }
    @media(max-width:640px){ body{padding:18px;} }

    /* Common UI components (moved from individual pages) */
    .topbar, .top { display:flex; align-items:center; justify-content: space-between; gap:16px; margin-bottom:24px; }
    .sub { color: var(--muted); font-size: 14px; }
    h1{ margin:0; font-size: 26px; letter-spacing:-0.02em; }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
    .card { position:relative; background: linear-gradient(145deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid var(--card-border); border-radius: var(--radius); padding:18px; box-shadow: 0 14px 40px rgba(0,0,0,0.25); overflow:hidden; transition: transform .18s ease, box-shadow .2s ease, border-color .2s ease; }
    .card::before { content:""; position:absolute; inset:0; background: radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 45%); opacity:0; transition: opacity .2s ease; pointer-events: none; }
    .card:hover { transform: translateY(-6px); box-shadow: var(--glow), 0 20px 50px rgba(0,0,0,0.35); border-color: var(--accent-strong); }
    .card:hover::before { opacity:1; }
    .meta { display:flex; flex-direction:column; gap:6px; margin-bottom:10px; }
    .name { font-weight:700; font-size:18px; letter-spacing:-0.01em; }
    .link { color: var(--muted); font-size:13px; word-break: break-word; }
    .pill { display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius: 999px; font-weight:700; font-size:11px; letter-spacing:0.01em; border:1px solid rgba(255,255,255,0.08); max-width:160px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; word-break:normal; flex-wrap:nowrap; }
    .pill-up { background: rgba(52,211,153,0.16); color: var(--up); }
    .pill-down { background: rgba(248,113,113,0.16); color: var(--down); }
    .pill-na { background: rgba(148,163,184,0.14); color: var(--muted); }
    .metrics { display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:10px; margin-top:10px; }
    .metric { background: rgba(255,255,255,0.02); border: 1px solid var(--card-border); border-radius: 12px; padding:10px 12px; display:flex; flex-direction:column; gap:4px; }
    .metric .label { color: var(--muted); font-size:12px; letter-spacing:0.01em; }
    .metric .value { font-weight:700; font-size:16px; }
    .sla { display:flex; align-items:center; gap:8px; }

    /* Metrics page helpers */
    .row{display:flex;gap:18px;align-items:stretch;flex-wrap:wrap;}
    .box{flex:1;min-width:320px; background: linear-gradient(150deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015)); border:1px solid var(--border); border-radius: var(--radius); padding:16px; box-shadow: 0 14px 40px rgba(0,0,0,0.25); position:relative; overflow:hidden; margin-bottom:18px; }
    .box::before{content:"";position:absolute;inset:0;background: radial-gradient(circle at 20% 15%, rgba(56,189,248,0.14), transparent 45%);opacity:0;transition:opacity .2s ease;pointer-events: none;}
    .box:hover::before{opacity:1}
    .chart-holder{position:relative;width:100%;height:360px;margin-top:10px}
    canvas{position:absolute;inset:0;width:100% !important;height:100% !important}
    .controls{display:flex;align-items:center;gap:10px;margin-bottom:4px}
    select{padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--text)}
    .stats{display:grid;grid-template-columns: repeat(auto-fit, minmax(150px,1fr)); gap:10px; margin-bottom:14px}
    .stat{padding:12px; border:1px solid var(--border); border-radius:12px; background: rgba(255,255,255,0.02); display:flex; flex-direction:column; gap:6px}
    .stat .label{color:var(--muted); font-size:12px}
    .stat .value{font-weight:700; font-size:18px}
    .actions{display:flex; gap:10px; align-items:center}
    .btn{padding:10px 14px; border-radius:10px; border:1px solid var(--border); background: linear-gradient(135deg, var(--accent), var(--accent-strong)); color:#0b1220; font-weight:700; text-decoration:none; box-shadow:0 10px 28px rgba(56,189,248,0.25); transition: transform .08s ease, box-shadow .12s ease}
    .btn:hover{transform: translateY(-1px); box-shadow:0 14px 34px rgba(56,189,248,0.32)}
    .btn.ghost{background: transparent; color: var(--text); border-color: var(--border); box-shadow:none}
    .btn.ghost:hover{border-color: var(--accent)}

    /* Admin page helpers */
    .shell { width: 380px; background: linear-gradient(160deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border-radius: var(--radius); border: 1px solid var(--border); padding: 20px; box-shadow: 0 18px 50px rgba(0,0,0,0.35); position: relative; overflow: hidden; }
    .panel { position: relative; background: linear-gradient(150deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid var(--border); border-radius: var(--radius); padding: 18px; box-shadow: 0 16px 44px rgba(0,0,0,0.28); overflow: hidden; margin-bottom: 18px }
    label { display:block; font-weight:600; margin-bottom:6px }
    input { box-sizing:border-box; width:100%; padding:10px; border-radius:10px; border:1px solid var(--border); background: rgba(255,255,255,0.03); color:var(--text) }
    .muted { color: var(--muted) }
    .del-btn { background:#ef4444; border:none; color:#fff; padding:8px 10px; border-radius:10px; cursor:pointer; box-shadow:0 8px 20px rgba(239,68,68,0.25) }
  </style>
  {% block head_extra %}{% endblock %}
</head>
<body>
  <button class="nav-toggle" aria-label="–ú–µ–Ω—é" type="button">‚ò∞</button>
  <div class="sidebar">
    <div class="logo">üî≠ Uptime</div>
    <nav>
      <a class="nav-link" data-path="/ui" href="/ui"><span>–ü–∞–Ω–µ–ª—å</span></a>
      <a class="nav-link" data-path="/ui/metrics" href="/ui/metrics"><span>–ú–µ—Ç—Ä–∏–∫–∏</span></a>
      <a class="nav-link" data-path="/admin/sites" href="/admin/sites"><span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</span></a>
    </nav>
  </div>
  <div class="sidebar-overlay"></div>

  <div class="page">
    {% macro fmt_seconds(s) %}
      {% set s = s | int %}
      {% set days = s // 86400 %}
      {% set hours = (s % 86400) // 3600 %}
      {% set minutes = (s % 3600) // 60 %}
      {% if days > 0 %}
        {{ days }} —Å—É—Ç {{ hours }} —á {{ minutes }} –º–∏–Ω
      {% elif hours > 0 %}
        {{ hours }} —á {{ minutes }} –º–∏–Ω
      {% else %}
        {{ minutes }} –º–∏–Ω
      {% endif %}
    {% endmacro %}

    {% block content %}{% endblock %}
  </div>

  <!-- Worker status widget (shared) -->
  <div id="worker-status" style="position:fixed;bottom:18px;right:18px; z-index:80; display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background: rgba(0,0,0,0.45); border:1px solid rgba(255,255,255,0.04); color:var(--text); font-weight:700;">
    <span id="worker-dot" style="width:12px;height:12px;border-radius:50%;background:var(--down);display:inline-block;box-shadow:0 2px 6px rgba(0,0,0,0.4);"></span>
    <span style="font-size:13px;">Monitoring Status</span>
  </div>

  <script>
    // Sidebar toggle + active nav highlighting (shared)
    (function(){
      const toggle = document.querySelector('.nav-toggle');
      const overlay = document.querySelector('.sidebar-overlay');
      const body = document.body;
      const setOpen = (v) => { if(v) body.classList.add('sidebar-open'); else body.classList.remove('sidebar-open'); };
      toggle?.addEventListener('click', () => setOpen(!body.classList.contains('sidebar-open')));
      overlay?.addEventListener('click', () => setOpen(false));
      window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') setOpen(false); });
      const path = window.location.pathname;
      document.querySelectorAll('.nav-link').forEach(link => {
        const base = link.dataset.path;
        if(path === base || path.startsWith(base + '/') || (base === '/ui' && (path === '/' || path === '/ui'))){
          link.classList.add('active');
        }
      });
    })();
  </script>

  <script>
    // Worker status updater (shared)
    (function(){
      const dot = document.getElementById('worker-dot');
      const container = document.getElementById('worker-status');
      if(!dot) return;
      async function update(){
        try{
          const res = await fetch('/worker-status');
          if(!res.ok) throw new Error('http');
          const js = await res.json();
          if(js.status === 'online'){
            dot.style.background = 'var(--up)';
            container.title = `Online ‚Äî last: ${js.last_check}`;
          } else {
            dot.style.background = 'var(--down)';
            container.title = js.last_check ? `Offline ‚Äî last: ${js.last_check}` : 'Offline ‚Äî no checks yet';
          }
        }catch(e){
          dot.style.background = 'var(--down)';
          container.title = 'Unknown (fetch failed)';
        }
      }
      update();
      setInterval(update, 30000);
    })();
  </script>

  {% block scripts_extra %}{% endblock %}
</body>
</html>
