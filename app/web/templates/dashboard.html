<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Uptime Dashboard</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap');
    :root{
      --bg: #0f172a;
      --panel: #111827;
      --surface: rgba(255,255,255,0.02);
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --accent-strong: #0ea5e9;
      --up: #34d399;
      --down: #f87171;
      --border: #0b1220;
      --card-border: #0a0f1a;
      --glow: 0 10px 40px rgba(56,189,248,0.18);
      --radius: 14px;
    }
    .theme-dark{ /* keep variables symmetrical for toggle */ }
    body { margin:0; padding:32px; background: radial-gradient(circle at 20% 20%, rgba(56,189,248,0.08), transparent 30%), radial-gradient(circle at 80% 0%, rgba(14,165,233,0.08), transparent 26%), var(--bg); color: var(--text); font-family: 'Space Grotesk', 'Inter', system-ui, -apple-system, sans-serif; }
    .page { max-width: 1200px; margin: 0 auto; }
    .topbar { display:flex; align-items:center; justify-content: space-between; gap:16px; margin-bottom:24px; }
    h1 { margin:0; font-size: 28px; letter-spacing:-0.02em; }
    .sub { color: var(--muted); font-size: 14px; }
    .theme-toggle { background: var(--surface); border: 1px solid var(--card-border); color: var(--text); padding: 10px 12px; border-radius: 12px; cursor: pointer; transition: border-color .15s ease, transform .12s ease; }
    .theme-toggle:hover { border-color: var(--accent); transform: translateY(-1px); }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
    .card { position:relative; background: linear-gradient(145deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid var(--card-border); border-radius: var(--radius); padding:18px; box-shadow: 0 14px 40px rgba(0,0,0,0.25); overflow:hidden; transition: transform .18s ease, box-shadow .2s ease, border-color .2s ease; }
    .card::before { content:""; position:absolute; inset:0; background: radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 45%); opacity:0; transition: opacity .2s ease; }
    .card:hover { transform: translateY(-6px); box-shadow: var(--glow), 0 20px 50px rgba(0,0,0,0.35); border-color: var(--accent-strong); }
    .card:hover::before { opacity:1; }
    .meta { display:flex; flex-direction:column; gap:6px; margin-bottom:10px; }
    .name { font-weight:700; font-size:18px; letter-spacing:-0.01em; }
    .link { color: var(--muted); font-size:13px; word-break: break-word; }
    .pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius: 999px; font-weight:700; font-size:12px; letter-spacing:0.01em; border:1px solid rgba(255,255,255,0.08); }
    .pill-up { background: rgba(52,211,153,0.16); color: var(--up); }
    .pill-down { background: rgba(248,113,113,0.16); color: var(--down); }
    .pill-na { background: rgba(148,163,184,0.14); color: var(--muted); }
    .metrics { display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:10px; margin-top:10px; }
    .metric { background: rgba(255,255,255,0.02); border: 1px solid var(--card-border); border-radius: 12px; padding:10px 12px; display:flex; flex-direction:column; gap:4px; }
    .metric .label { color: var(--muted); font-size:12px; letter-spacing:0.01em; }
    .metric .value { font-weight:700; font-size:16px; }
    .sla { display:flex; align-items:center; gap:8px; }
    a { color: var(--accent); text-decoration:none; }
    a:hover { text-decoration: underline; }
    @media(max-width:640px){ body{padding:18px;} .topbar{flex-direction:column; align-items:flex-start;} }
  </style>
</head>
<body>
  <div class="page">
    <div class="topbar">
      <div>
        <h1>Uptime Dashboard</h1>
        <div class="sub">Live status and SLA at a glance</div>
      </div>
      <button id="theme-toggle" class="theme-toggle" aria-pressed="false">ðŸŒ™ Dark</button>
    </div>

    <div class="grid">
      {% for item in items %}
      {% set site = item.site %}
      {% set latest = item.latest %}
      {% set metrics = item.metrics %}
      <div class="card">
        <div class="meta">
          <div class="name"><a href="/ui/sites/{{site.id}}">{{ site.name }}</a></div>
          <a class="link" href="{{ site.url }}" target="_blank" rel="noopener">{{ site.url }}</a>
        </div>
        <div>
          {% if latest %}
            <span class="pill {{ 'pill-up' if latest.status.value == 'UP' else 'pill-down' }}">{{ latest.status.value }}</span>
          {% else %}
            <span class="pill pill-na">N/A</span>
          {% endif %}
        </div>
        <div class="metrics">
          <div class="metric">
            <div class="label">Availability (24h)</div>
            <div class="value">{% if metrics.availability is not none %}{{ '%.2f' % (metrics.availability * 100) }}%{% else %}N/A{% endif %}</div>
          </div>
          <div class="metric">
            <div class="label">Uptime</div>
            <div class="value">{{ '%.1f' % metrics.uptime_seconds }} s</div>
          </div>
          <div class="metric">
            <div class="label">Downtime</div>
            <div class="value">{{ '%.1f' % metrics.downtime_seconds }} s</div>
          </div>
          <div class="metric">
            <div class="label">SLA</div>
            <div class="value sla">
              {% if metrics.sla_target_per_mille is not none and metrics.availability is not none %}
                {{ metrics.sla_target_per_mille / 10 }}% {% if metrics.sla_met %}<span class="pill pill-up">OK</span>{% else %}<span class="pill pill-down">BREACH</span>{% endif %}
              {% else %}N/A{% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <script>
    (function(){
      const key = 'uptime-theme';
      const btn = document.getElementById('theme-toggle');
      function apply(theme){
        if(theme === 'dark') document.documentElement.classList.add('theme-dark');
        else document.documentElement.classList.remove('theme-dark');
        if(btn){
          btn.setAttribute('aria-pressed', theme === 'dark');
          btn.textContent = theme === 'dark' ? 'â˜€ï¸ Light' : 'ðŸŒ™ Dark';
        }
      }
      const stored = localStorage.getItem(key) || 'light';
      apply(stored);
      if(btn){
        btn.addEventListener('click', ()=>{
          const next = (localStorage.getItem(key) || 'light') === 'dark' ? 'light' : 'dark';
          localStorage.setItem(key, next);
          apply(next);
        });
      }
    })();
  </script>
</body>
</html>
