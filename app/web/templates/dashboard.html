{% extends "base.html" %}

{% block title %}Панель мониторинга{% endblock %}

{% block content %}
  <div class="topbar">
    <div>
      <h1>Панель мониторинга</h1>
      <div class="sub">Текущий статус и SLA</div>
    </div>
  </div>

  <div class="grid">
    {% for item in items %}
    {% set site = item.site %}
    {% set latest = item.latest %}
    {% set metrics = item.metrics %}
    <div class="card">
      <div class="meta">
        <div class="name"><a href="/ui/sites/{{site.id}}">{{ site.name }}</a></div>
        <a class="link" href="{{ site.url }}" target="_blank" rel="noopener">{{ site.url }}</a>
      </div>
      <div>
        {% if latest %}
          {% if latest.status.value == 'UP' %}
            <span class="pill pill-up">Доступен</span>
          {% elif latest.status.value == 'DOWN' %}
            <span class="pill pill-down">Недоступен</span>
          {% else %}
            <span class="pill">{{ latest.status.value }}</span>
          {% endif %}
        {% else %}
          <span class="pill pill-na">N/A</span>
        {% endif %}
      </div>
      <div class="metrics">
        <div class="metric">
          <div class="label">Доступность (24ч)</div>
          <div class="value">{% if metrics.availability is not none %}{{ '%.2f' % (metrics.availability * 100) }}%{% else %}N/A{% endif %}</div>
        </div>
        <div class="metric">
          <div class="label">Uptime</div>
            <div class="value">{{ fmt_seconds(metrics.uptime_seconds) }}</div>
        </div>
        <div class="metric">
          <div class="label">Downtime</div>
            <div class="value">{{ fmt_seconds(metrics.downtime_seconds) }}</div>
        </div>
        <div class="metric">
          <div class="label">SLA</div>
          <div class="value sla">
            {% if metrics.sla_target_per_mille is not none and metrics.availability is not none %}
              {{ metrics.sla_target_per_mille / 10 }}% {% if metrics.sla_met %}
                <span class="pill" title="Норма" style="padding:3px; border-radius:50%; width:6px; height:6px; display:inline-block; background:var(--up); box-shadow:0 1px 3px rgba(0,0,0,0.25);"></span>
              {% else %}
                <span class="pill" title="Нарушение" style="padding:3px; border-radius:50%; width:6px; height:6px; display:inline-block; background:var(--down); box-shadow:0 1px 3px rgba(0,0,0,0.25);"></span>
              {% endif %}
            {% else %}N/A{% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
{% endblock %}
