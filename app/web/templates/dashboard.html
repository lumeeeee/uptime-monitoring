<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Uptime Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; background: #f7f9fb; color: #1f2933; }
    h1 { margin-bottom: 12px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; }
    .card { background: #fff; padding: 16px; border-radius: 8px; box-shadow: 0 1px 4px rgba(16,24,40,0.06); }
    .card h2 { margin: 0 0 6px 0; font-size: 18px; }
    .card .meta { font-size: 13px; color: #475569; margin-bottom: 10px; }
    .card .metrics { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .metric { background: #f1f5f9; padding: 6px 8px; border-radius: 6px; font-weight: 600; font-size: 13px; }
    .metric.big { font-size: 18px; padding: 8px 10px; }
    .status-up { color: #0b8a3c; font-weight: 700; }
    .status-down { color: #c0392b; font-weight: 700; }
    .pill { padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; display: inline-block; }
    .pill-up { background: #e6f6ec; color: #0b8a3c; }
    .pill-down { background: #fdecea; color: #c0392b; }
    .pill-na { background: #f1f5f9; color: #475569; }
    a { color: #2563eb; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>Uptime Dashboard</h1>
  <div class="grid">
    {% for item in items %}
    {% set site = item.site %}
    {% set latest = item.latest %}
    {% set metrics = item.metrics %}
    <div class="card">
      <h2><a href="/ui/sites/{{site.id}}">{{ site.name }}</a></h2>
      <div class="meta"><a href="{{ site.url }}" target="_blank" rel="noopener">{{ site.url }}</a></div>
      <div style="margin-bottom:8px;">
        {% if latest %}
          <span class="pill {{ 'pill-up' if latest.status.value == 'UP' else 'pill-down' }}">{{ latest.status.value }}</span>
        {% else %}
          <span class="pill pill-na">N/A</span>
        {% endif %}
      </div>
      <div class="metrics">
        <div class="metric big">
          {% if metrics.availability is not none %}
            {{ '%.2f' % (metrics.availability * 100) }}%
          {% else %}N/A{% endif %}
        </div>
        <div class="metric">Uptime: {{ '%.1f' % metrics.uptime_seconds }} s</div>
        <div class="metric">Downtime: {{ '%.1f' % metrics.downtime_seconds }} s</div>
        <div class="metric">
          {% if metrics.sla_target_per_mille is not none and metrics.availability is not none %}
            SLA: {{ metrics.sla_target_per_mille / 10 }}% 
            {% if metrics.sla_met %}<span class="pill pill-up">OK</span>{% else %}<span class="pill pill-down">BREACH</span>{% endif %}
          {% else %}SLA: N/A{% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</body>
</html>
