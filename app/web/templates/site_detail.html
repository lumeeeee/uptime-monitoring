<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ site.name }} - Details</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap');
    :root{
      --bg: #0f172a;
      --panel: #0b1220;
      --surface: rgba(255,255,255,0.02);
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --accent-strong: #0ea5e9;
      --up: #34d399;
      --down: #f87171;
      --border: #0b1220;
      --card-border: #0a0f1a;
      --radius: 14px;
    }
    body { margin:0; padding:28px; background: radial-gradient(circle at 30% 10%, rgba(56,189,248,0.08), transparent 32%), radial-gradient(circle at 85% 15%, rgba(14,165,233,0.08), transparent 28%), var(--bg); color: var(--text); font-family: 'Space Grotesk','Inter',system-ui,sans-serif; }
    .page { max-width: 1100px; margin: 0 auto; }
    .top { display:flex; align-items:center; justify-content: space-between; gap:12px; margin-bottom:18px; }
    .back { color: var(--muted); font-size:13px; }
    h1 { margin:6px 0 0 0; font-size:26px; letter-spacing:-0.01em; }
    .theme-toggle { background: var(--surface); border: 1px solid var(--card-border); color: var(--text); padding: 10px 12px; border-radius: 12px; cursor: pointer; }
    .card { position:relative; background: linear-gradient(150deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015)); border: 1px solid var(--card-border); border-radius: var(--radius); padding:18px; box-shadow: 0 14px 40px rgba(0,0,0,0.25); margin-bottom:16px; overflow:hidden; }
    .card::before{ content:""; position:absolute; inset:0; background: radial-gradient(circle at 15% 15%, rgba(56,189,248,0.12), transparent 40%); opacity:0; transition: opacity .2s ease; }
    .card:hover::before{ opacity:1; }
    a { color: var(--accent); text-decoration:none; }
    a:hover { text-decoration: underline; }
    .pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius: 999px; font-weight:700; font-size:12px; border:1px solid rgba(255,255,255,0.08); }
    .pill-up { background: rgba(52,211,153,0.16); color: var(--up); }
    .pill-down { background: rgba(248,113,113,0.16); color: var(--down); }
    .pill-na { background: rgba(148,163,184,0.16); color: var(--muted); }
    .metrics { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:12px; margin-top:12px; }
    .metric { padding:12px; border:1px solid var(--card-border); border-radius:12px; background: rgba(255,255,255,0.02); }
    .metric .label { color: var(--muted); font-size:12px; }
    .metric .value { font-size:18px; font-weight:700; }
    table { width:100%; border-collapse: collapse; margin-top:8px; }
    th, td { padding:10px 12px; text-align:left; border-bottom:1px solid rgba(255,255,255,0.06); font-size:13px; }
    th { color: var(--muted); font-weight:600; letter-spacing:0.01em; }
    tr:last-child td { border-bottom:none; }
    @media(max-width:640px){ body{padding:18px;} .top{flex-direction:column; align-items:flex-start;} }
  </style>
</head>
<body>
  <div class="page">
    {% macro fmt_seconds(s) %}
      {% set s = s | int %}
      {% set days = s // 86400 %}
      {% set hours = (s % 86400) // 3600 %}
      {% set minutes = (s % 3600) // 60 %}
      {% if days > 0 %}
        {{ days }} сут {{ hours }} ч {{ minutes }} мин
      {% elif hours > 0 %}
        {{ hours }} ч {{ minutes }} мин
      {% else %}
        {{ minutes }} мин
      {% endif %}
    {% endmacro %}
    <div class="top">
      <div>
        <a class="back" href="/ui">← Назад в панель</a>
        <h1>{{ site.name }}</h1>
      </div>
      
    </div>

    <div class="card">
      <div style="display:flex; flex-direction:column; gap:8px;">
        <div><strong>URL:</strong> <a href="{{ site.url }}" target="_blank" rel="noopener">{{ site.url }}</a></div>
        <div><strong>Статус:</strong>
          {% if latest %}
            <span class="pill {{ 'pill-up' if latest.status.value == 'UP' else 'pill-down' }}">{{ latest.status.value }}</span>
          {% else %}
            <span class="pill pill-na">N/A</span>
          {% endif %}
        </div>
      </div>
      <div class="metrics">
        <div class="metric">
          <div class="label">Доступность (24ч)</div>
          <div class="value">{% if metrics.availability is not none %}{{ '%.2f' % (metrics.availability * 100) }}%{% else %}N/A{% endif %}</div>
        </div>
        <div class="metric">
          <div class="label">Uptime</div>
            <div class="value">{{ fmt_seconds(metrics.uptime_seconds) }}</div>
        </div>
        <div class="metric">
          <div class="label">Downtime</div>
            <div class="value">{{ fmt_seconds(metrics.downtime_seconds) }}</div>
        </div>
        <div class="metric">
          <div class="label">SLA</div>
          <div class="value">
            {% if metrics.sla_target_per_mille is not none and metrics.availability is not none %}
              {{ metrics.sla_target_per_mille / 10 }}% {% if metrics.sla_met %}<span class="pill pill-up">Норма</span>{% else %}<span class="pill pill-down">Нарушение</span>{% endif %}
            {% else %}N/A{% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 10px 0;">Последние инциденты</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Начало</th>
            <th>Окончание</th>
            <th>Последний статус</th>
            <th>Решён</th>
          </tr>
        </thead>
        <tbody>
          {% for inc in incidents %}
          <tr>
            <td>{{ inc.id }}</td>
            <td>{{ inc.start_ts }}</td>
            <td>{{ inc.end_ts if inc.end_ts else '—' }}</td>
            <td>{{ inc.last_status.value }}</td>
            <td>{{ 'Yes' if inc.resolved else 'No' }}</td>
          </tr>
          {% endfor %}
          {% if incidents|length == 0 %}
          <tr><td colspan="5">No incidents</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
  
</body>
</html>
