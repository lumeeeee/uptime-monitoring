{% extends "base.html" %}

{% block title %}{{ site.name }} — Детали{% endblock %}

{% block content %}
  <div class="top">
    <div>
      <a class="back" href="/ui">← Назад в панель</a>
      <h1>{{ site.name }}</h1>
    </div>
  </div>

  <div class="card">
    <div style="display:flex; flex-direction:column; gap:8px;">
      <div><strong>URL:</strong> <a href="{{ site.url }}" target="_blank" rel="noopener">{{ site.url }}</a></div>
      <div><strong>Статус:</strong>
        {% if latest %}
          <span class="pill {{ 'pill-up' if latest.status.value == 'UP' else 'pill-down' }}">{% if latest.status.value == 'UP' %}Доступен{% elif latest.status.value == 'DOWN' %}Недоступен{% else %}{{ latest.status.value }}{% endif %}</span>
        {% else %}
          <span class="pill pill-na">N/A</span>
        {% endif %}
      </div>
    </div>
    <div class="metrics">
      <div class="metric">
        <div class="label">Доступность (24ч)</div>
        <div class="value">{% if metrics.availability is not none %}{{ '%.2f' % (metrics.availability * 100) }}%{% else %}N/A{% endif %}</div>
      </div>
      <div class="metric">
        <div class="label">Uptime</div>
          <div class="value">{{ fmt_seconds(metrics.uptime_seconds) }}</div>
      </div>
      <div class="metric">
        <div class="label">Downtime</div>
          <div class="value">{{ fmt_seconds(metrics.downtime_seconds) }}</div>
      </div>
      <div class="metric">
        <div class="label">SLA</div>
        <div class="value">
          {% if metrics.sla_target_per_mille is not none and metrics.availability is not none %}
            {{ metrics.sla_target_per_mille / 10 }}% {% if metrics.sla_met %}
              <span class="pill" title="Норма" style="padding:3px; border-radius:50%; width:6px; height:6px; display:inline-block; background:var(--up); box-shadow:0 1px 3px rgba(0,0,0,0.25);"></span>
            {% else %}
              <span class="pill" title="Нарушение" style="padding:3px; border-radius:50%; width:6px; height:6px; display:inline-block; background:var(--down); box-shadow:0 1px 3px rgba(0,0,0,0.25);"></span>
            {% endif %}
          {% else %}N/A{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px 0;">Последние инциденты</h3>
    <table>
      <thead>
        <tr>
          <th>№</th>
          <th>ID</th>
          <th>Начало</th>
          <th>Окончание</th>
          <th>Последний статус</th>
          <th>Решён</th>
        </tr>
      </thead>
      <tbody>
        {% for inc in incidents %}
        <tr>
          <td>{{ loop.revindex }}</td>
          <td>{{ inc.id }}</td>
          <td>{{ inc.start_ts }}</td>
          <td>{{ inc.end_ts if inc.end_ts else '—' }}</td>
          <td>{% if inc.last_status == 'UP' %}Доступен{% elif inc.last_status == 'DOWN' %}Недоступен{% else %}{{ inc.last_status }}{% endif %}</td>
          <td>{{ 'Да' if inc.resolved else 'Нет' }}</td>
        </tr>
        {% endfor %}
        {% if incidents|length == 0 %}
        <tr><td colspan="6">Инциденты отсутствуют</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}

